<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#"><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <title>Moleculer Go - Progressive microservices framework in Go</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="microservices, nodejs, node.js, javascript, github, opensource, framework, moleculer, github, scaling">
  <meta name="description" content="Moleculer is a fast, scalable and powerful microservices framework for Node.js.">
  <meta name="robots" content="index, follow">
  <!-- Canonical links -->
  <link rel="canonical" href="https://gomicro.services/docs/0.1/caching.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://gomicro.services/docs/0.1/caching.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/moleculer.css -->
  <link rel="stylesheet" href="/css/moleculer.css">
  <!-- endbuild -->
  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Roboto Mono|Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
  <!-- RSS
  <link rel="alternate" href="/atom.xml" title="Moleculer Go - Progressive microservices framework in Go">
  -->
  <!-- Open Graph -->
  <meta name="description" content="Caching WIP Documentation This documentation is still a working in progress and this page has not been fully converted yet :( We are working on top of the existing Moleculer JS documentation, and that">
<meta property="og:type" content="website">
<meta property="og:title" content="Moleculer Go - Progressive microservices framework in Go">
<meta property="og:url" content="https://gomicro.services/docs/0.1/caching.html">
<meta property="og:site_name" content="Moleculer Go - Progressive microservices framework in Go">
<meta property="og:description" content="Caching WIP Documentation This documentation is still a working in progress and this page has not been fully converted yet :( We are working on top of the existing Moleculer JS documentation, and that">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://gomicro.services/docs/0.1/assets/under_construction.png">
<meta property="og:image" content="https://img.shields.io/badge/performance-%2B20%25-brightgreen.svg">
<meta property="og:updated_time" content="2019-04-22T02:47:21.439Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Moleculer Go - Progressive microservices framework in Go">
<meta name="twitter:description" content="Caching WIP Documentation This documentation is still a working in progress and this page has not been fully converted yet :( We are working on top of the existing Moleculer JS documentation, and that">
<meta name="twitter:image" content="https://gomicro.services/docs/0.1/assets/under_construction.png">
<meta name="twitter:site" content="MoleculerG">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99099811-1', 'auto');
  ga('send', 'pageview');
</script>


  <!-- Particles -->
  <script src="/js/buttons.js"></script>

</head>

<body>
  <div id="particles-js"></div>
  <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/" id="logo">Moleculer</a>
    </h1>
    <nav id="main-nav">
      <a href="/docs/0.1/" class="main-nav-link">Documentation</a><a href="/modules.html" class="main-nav-link">Modules</a><a href="/support.html" class="main-nav-link">Support</a>
      <a href="https://github.com/moleculer-go/moleculer" class="main-nav-link">Github</a>
      <a href="https://gitter.im/moleculer-go/moleculer" class="main-nav-link">Chat</a>
      <div id="search-input-wrap" class="on">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <div id="lang-select-wrap" style="display: none">
      <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
      <select id="lang-select" data-canonical="">
        
          <option value="en" selected>English</option>
        
      </select>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

  <div id="container">
    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope="" itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <div class="article-content" itemprop="articleBody">
                <a href="https://github.com/moleculer-go/site/edit/master/source/docs/0.1/caching.md" class="corner-right article-edit-link" title="Improve this doc"><i class="fa fa-pencil"></i></a>
                <h1 id="Caching" class="article-heading"><a href="#Caching" class="headerlink" title="Caching"></a>Caching<a class="article-anchor" href="#Caching" aria-hidden="true"></a></h1><hr>
<blockquote class="note info"><strong class="note-title">WIP Documentation</strong><p><img src="assets/under_construction.png" width="150/"></p>
<p>This documentation is still a working in progress and this page has not been fully converted yet :(</p>
<p>We are working on top of the existing Moleculer JS documentation, and that is why you might see pages with some JavaScript :)</p>
</blockquote>
<p>Moleculer has a built-in caching solution to cache responses of service actions. To enable it, set a <code>cacher</code> type in <a href="broker.html#Broker-options">broker option</a> and set the <code>cache: true</code> in <a href="services.html#Actions">action definition</a> what you want to cache.</p>
<p><strong>Cached action example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ServiceBroker &#125; = <span class="built_in">require</span>(<span class="string">"moleculer"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create broker</span></span><br><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="string">"Memory"</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create a service</span></span><br><span class="line">broker.createService(&#123;</span><br><span class="line">    name: <span class="string">"users"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        list: &#123;</span><br><span class="line">            <span class="comment">// Enable caching to this action</span></span><br><span class="line">            cache: <span class="literal">true</span>,</span><br><span class="line">            handler(ctx) &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.info(<span class="string">"Handler called!"</span>);</span><br><span class="line">                <span class="keyword">return</span> [&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"John"</span> &#125;, &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">"Jane"</span> &#125;];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">broker</span><br><span class="line">    .start()</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Will be called the handler, because the cache is empty</span></span><br><span class="line">        <span class="keyword">return</span> broker</span><br><span class="line">            .call(<span class="string">"users.list"</span>)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span> broker.logger.info(<span class="string">"Users count:"</span>, res.length));</span><br><span class="line">    &#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// Return from cache, handler won't be called</span></span><br><span class="line">        <span class="keyword">return</span> broker</span><br><span class="line">            .call(<span class="string">"users.list"</span>)</span><br><span class="line">            .then(<span class="function"><span class="params">res</span> =&gt;</span></span><br><span class="line">                broker.logger.info(<span class="string">"Users count from cache:"</span>, res.length)</span><br><span class="line">            );</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>Console messages:</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[2017-08-18T13:04:33.845Z] INFO  dev-pc/BROKER: Broker started.</span><br><span class="line">[2017-08-18T13:04:33.848Z] INFO  dev-pc/USERS: Handler called!</span><br><span class="line">[2017-08-18T13:04:33.849Z] INFO  dev-pc/BROKER: Users count: 2</span><br><span class="line">[2017-08-18T13:04:33.849Z] INFO  dev-pc/BROKER: Users count from cache: 2</span><br></pre></td></tr></table></figure>
<p>As you can see, the <code>Handler called</code> message appears only once because the response of second request is returned from the cache.</p>
<blockquote>
<p><a href="https://runkit.com/icebob/moleculer-cacher-example2" target="_blank" rel="noopener">Try it on Runkit</a></p>
</blockquote>
<h2 id="Cache-keys" class="article-heading"><a href="#Cache-keys" class="headerlink" title="Cache keys"></a>Cache keys<a class="article-anchor" href="#Cache-keys" aria-hidden="true"></a></h2><p>The cacher generates key from service name, action name and the params of context.<br>The syntax of key is:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;serviceName&gt;.&lt;actionName&gt;:&lt;parameters or hash of parameters&gt;</span><br></pre></td></tr></table></figure>
<p>So if you call the <code>posts.list</code> action with params <code>{ limit: 5, offset: 20 }</code>, the cacher calculates a hash from the params. So the next time, when you call this action with the same params, it will find the entry in the cache by key.</p>
<p><strong>Example hashed cache key for “posts.find” action</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">posts.find:limit|5|offset|20</span><br></pre></td></tr></table></figure>
<p>However, the params can contain properties which is not relevant for the cache key. On the other hand, it can cause performance issues if the key is too long. Therefore it is recommended to set an object for <code>cache</code> property which contains a list of essential parameter names under the <code>keys</code> property.</p>
<p><strong>Strict the list of <code>params</code> &amp; <code>meta</code> properties for key generation</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    name: <span class="string">"posts"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        list: &#123;</span><br><span class="line">            cache: &#123;</span><br><span class="line">                <span class="comment">//  generate cache key from "limit", "offset" params and "user.id" meta</span></span><br><span class="line">                keys: [<span class="string">"limit"</span>, <span class="string">"offset"</span>,<span class="string">"#user.id"</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            handler(ctx) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.getList(ctx.params.limit, ctx.params.offset);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If params is &#123; limit: 10, offset: 30 &#125; and meta is &#123; user: &#123; id: 123 &#125; &#125;, the cache key will be:</span></span><br><span class="line"><span class="comment">//   posts.list:10|30|123</span></span><br></pre></td></tr></table></figure>
<blockquote class="note info"><strong class="note-title">Performance</strong><p>This solution is pretty fast, so we recommend to use it in production. <img src="https://img.shields.io/badge/performance-%2B20%25-brightgreen.svg" alt=""></p>
</blockquote>
<h3 id="Cache-meta-keys" class="article-heading"><a href="#Cache-meta-keys" class="headerlink" title="Cache meta keys"></a>Cache meta keys<a class="article-anchor" href="#Cache-meta-keys" aria-hidden="true"></a></h3><p>To use meta keys in cache <code>keys</code> use the <code>#</code> prefix.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    name: <span class="string">"posts"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        list: &#123;</span><br><span class="line">            cache: &#123;</span><br><span class="line">                <span class="comment">// Cache key:  "limit" &amp; "offset" from ctx.params, "user.id" from ctx.meta</span></span><br><span class="line">                keys: [<span class="string">"limit"</span>, <span class="string">"offset"</span>, <span class="string">"#user.id"</span>],</span><br><span class="line">                ttl: <span class="number">5</span></span><br><span class="line">            &#125;,</span><br><span class="line">            handler(ctx) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Limiting-cache-key-length" class="article-heading"><a href="#Limiting-cache-key-length" class="headerlink" title="Limiting cache key length"></a>Limiting cache key length<a class="article-anchor" href="#Limiting-cache-key-length" aria-hidden="true"></a></h3><p>Occasionally, the key can be very long, which can cause performance issues. To avoid it, maximize the length of concatenated params in the key with <code>maxParamsLength</code> cacher option. When the key is longer than this configured limitvalue, the cacher calculates a hash (SHA256) from the full key and adds it to the end of the key.</p>
<blockquote>
<p>The minimum of <code>maxParamsLength</code> is <code>44</code> (SHA 256 hash length in Base64).</p>
<p>To disable this feature, set it to <code>0</code> or <code>null</code>.</p>
</blockquote>
<p><strong>Generate a full key from the whole params without limit</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">cacher.getCacheKey("posts.find", &#123; id: 2, # "New post", content: "It can be very very looooooooooooooooooong content. So this key will also be too long" &#125;);</span><br><span class="line"><span class="comment">// Key: 'posts.find:id|2|title|New post|content|It can be very very looooooooooooooooooong content. So this key will also be too long'</span></span><br></pre></td></tr></table></figure>
<p><strong>Generate a limited-length key</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"Memory"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            maxParamsLength: <span class="number">60</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">cacher.getCacheKey("posts.find", &#123; id: 2, # "New post", content: "It can be very very looooooooooooooooooong content. So this key will also be too long" &#125;);</span><br><span class="line"><span class="comment">// Key: 'posts.find:id|2|title|New pL4ozUU24FATnNpDt1B0t1T5KP/T5/Y+JTIznKDspjT0='</span></span><br></pre></td></tr></table></figure>
<h2 id="Conditional-caching" class="article-heading"><a href="#Conditional-caching" class="headerlink" title="Conditional caching"></a>Conditional caching<a class="article-anchor" href="#Conditional-caching" aria-hidden="true"></a></h2><p>Conditional caching allows to bypass the cached response and execute an action in order to obtain “fresh” data.<br>To bypass the cache set <code>ctx.meta.$cache</code> to <code>false</code> before calling an action.</p>
<p><strong>Example of turning off the caching for the <code>greeter.hello</code> action</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.call(<span class="string">"greeter.hello"</span>, &#123; <span class="attr">name</span>: <span class="string">"Moleculer"</span> &#125;, &#123; <span class="attr">meta</span>: &#123; <span class="attr">$cache</span>: <span class="literal">false</span> &#125;&#125;))</span><br></pre></td></tr></table></figure>
<p>As an alternative, a custom function can be implemented to enable bypassing the cache. The custom function accepts as an argument the context (<code>ctx</code>) instance therefore it has access any params or meta data. This allows to pass the bypass flag within the request.</p>
<p><strong>Example of a custom conditional caching function</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// greeter.service.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    name: <span class="string">"greeter"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        hello: &#123;</span><br><span class="line">            cache: &#123;</span><br><span class="line">                enabled: <span class="function"><span class="params">ctx</span> =&gt;</span> ctx.params.noCache !== <span class="literal">true</span>, <span class="comment">//`noCache` passed as a parameter</span></span><br><span class="line">                keys: [<span class="string">"name"</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            handler(ctx) &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(chalk.yellow(<span class="string">"Execute handler"</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`Hello <span class="subst">$&#123;ctx.params.name&#125;</span>`</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use custom `enabled` function to turn off caching for this request</span></span><br><span class="line">broker.call(<span class="string">"greeter.hello"</span>, &#123; <span class="attr">name</span>: <span class="string">"Moleculer"</span>, <span class="attr">noCache</span>: <span class="literal">true</span> &#125;))</span><br></pre></td></tr></table></figure>
<h2 id="TTL" class="article-heading"><a href="#TTL" class="headerlink" title="TTL"></a>TTL<a class="article-anchor" href="#TTL" aria-hidden="true"></a></h2><p>Default TTL setting can be overriden in action definition.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"memory"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ttl: <span class="number">30</span> <span class="comment">// 30 seconds</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">broker.createService(&#123;</span><br><span class="line">    name: <span class="string">"posts"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        list: &#123;</span><br><span class="line">            cache: &#123;</span><br><span class="line">                <span class="comment">// These cache entries will be expired after 5 seconds instead of 30.</span></span><br><span class="line">                ttl: <span class="number">5</span></span><br><span class="line">            &#125;,</span><br><span class="line">            handler(ctx) &#123;</span><br><span class="line">                <span class="comment">// ...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Custom-key-generator" class="article-heading"><a href="#Custom-key-generator" class="headerlink" title="Custom key-generator"></a>Custom key-generator<a class="article-anchor" href="#Custom-key-generator" aria-hidden="true"></a></h2><p>To overwrite the built-in cacher key generator, set your own function as <code>keygen</code> in cacher options.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"memory"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            keygen(name, params, meta, keys) &#123;</span><br><span class="line">                <span class="comment">// Generate a cache key</span></span><br><span class="line">                <span class="comment">// name - action name</span></span><br><span class="line">                <span class="comment">// params - ctx.params</span></span><br><span class="line">                <span class="comment">// meta - ctx.meta</span></span><br><span class="line">                <span class="comment">// keys - cache keys defined in action</span></span><br><span class="line">                <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Manual-caching" class="article-heading"><a href="#Manual-caching" class="headerlink" title="Manual caching"></a>Manual caching<a class="article-anchor" href="#Manual-caching" aria-hidden="true"></a></h2><p>The cacher module can be used manually. Just call the <code>get</code>, <code>set</code>, <code>del</code> methods of <code>broker.cacher</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Save to cache</span></span><br><span class="line">broker.cacher.set(<span class="string">"mykey.a"</span>, &#123; <span class="attr">a</span>: <span class="number">5</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get from cache (async)</span></span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">await</span> broker.cacher.get(<span class="string">"mykey.a"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove entry from cache</span></span><br><span class="line">broker.cacher.del(<span class="string">"mykey.a"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Clean all 'mykey' entries</span></span><br><span class="line">broker.cacher.clean(<span class="string">"mykey.**"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Clean all entries</span></span><br><span class="line">broker.cacher.clean();</span><br></pre></td></tr></table></figure>
<p>Additionally, the complete <a href="https://github.com/luin/ioredis" target="_blank" rel="noopener">ioredis</a> client API is available at <code>broker.cacher.client</code> when using the built-in Redis cacher:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// create an ioredis pipeline</span></span><br><span class="line"><span class="keyword">const</span> pipeline = broker.cacher.client.pipeline();</span><br><span class="line"><span class="comment">// set values in cache</span></span><br><span class="line">pipeline.set(<span class="string">"mykey.a"</span>, <span class="string">"myvalue.a"</span>);</span><br><span class="line">pipeline.set(<span class="string">"mykey.b"</span>, <span class="string">"myvalue.b"</span>);</span><br><span class="line"><span class="comment">// execute pipeline</span></span><br><span class="line">pipeline.exec();</span><br></pre></td></tr></table></figure>
<h2 id="Clear-cache" class="article-heading"><a href="#Clear-cache" class="headerlink" title="Clear cache"></a>Clear cache<a class="article-anchor" href="#Clear-cache" aria-hidden="true"></a></h2><p>When you create a new model in your service, sometimes you have to clear the old cached model entries.</p>
<p><strong>Example to clean the cache inside actions</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    name: <span class="string">"users"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        create(ctx) &#123;</span><br><span class="line">            <span class="comment">// Create new user entity</span></span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">new</span> User(ctx.params);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Clear all cache entries</span></span><br><span class="line">            <span class="keyword">this</span>.broker.cacher.clean();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Clear all cache entries which keys start with `users.`</span></span><br><span class="line">            <span class="keyword">this</span>.broker.cacher.clean(<span class="string">"users.**"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Clear multiple cache entries</span></span><br><span class="line">            <span class="keyword">this</span>.broker.cacher.clean([ <span class="string">"users.**"</span>, <span class="string">"posts.**"</span> ]);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Delete an entry</span></span><br><span class="line">            <span class="keyword">this</span>.broker.cacher.del(<span class="string">"users.list"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Delete multiple entries</span></span><br><span class="line">            <span class="keyword">this</span>.broker.cacher.del([ <span class="string">"users.model:5"</span>, <span class="string">"users.model:8"</span> ]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Clear-cache-among-multiple-service-instances" class="article-heading"><a href="#Clear-cache-among-multiple-service-instances" class="headerlink" title="Clear cache among multiple service instances"></a>Clear cache among multiple service instances<a class="article-anchor" href="#Clear-cache-among-multiple-service-instances" aria-hidden="true"></a></h3><p>The best practice to clear cache entries among multiple service instances is that use broadcast events.</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    name: <span class="string">"users"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        create(ctx) &#123;</span><br><span class="line">            <span class="comment">// Create new user entity</span></span><br><span class="line">            <span class="keyword">const</span> user = <span class="keyword">new</span> User(ctx.params);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Clear cache</span></span><br><span class="line">            <span class="keyword">this</span>.cleanCache();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">        cleanCache() &#123;</span><br><span class="line">            <span class="comment">// Broadcast the event, so all service instances receive it (including this instance).</span></span><br><span class="line">            <span class="keyword">this</span>.broker.broadcast(<span class="string">"cache.clean.users"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    events: &#123;</span><br><span class="line">        <span class="string">"cache.clean.users"</span>() &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.broker.cacher) &#123;</span><br><span class="line">                <span class="keyword">this</span>.broker.cacher.clean(<span class="string">"users.**"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Clear-cache-among-different-services" class="article-heading"><a href="#Clear-cache-among-different-services" class="headerlink" title="Clear cache among different services"></a>Clear cache among different services<a class="article-anchor" href="#Clear-cache-among-different-services" aria-hidden="true"></a></h3><p>Common way is that your service depends on other ones. E.g. <code>posts</code> service stores information from <code>users</code> service in cached entries (in case of populating).</p>
<p><strong>Example cache entry in <code>posts</code> service</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    _id: <span class="number">1</span>,</span><br><span class="line">    # "My post",</span><br><span class="line">    content: <span class="string">"Some content"</span>,</span><br><span class="line">    author: &#123;</span><br><span class="line">        _id: <span class="number">130</span>,</span><br><span class="line">        fullName: <span class="string">"John Doe"</span>,</span><br><span class="line">        avatar: <span class="string">"https://..."</span></span><br><span class="line">    &#125;,</span><br><span class="line">    createdAt: <span class="number">1519729167666</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>author</code> field is received from <code>users</code> service. So if the <code>users</code> service clears cache entries, the <code>posts</code> service has to clear own cache entries, as well. Therefore you should also subscribe to the <code>cache.clear.users</code> event in <code>posts</code> service.</p>
<p>To make it easier, create a <code>CacheCleaner</code> mixin and define in constructor the dependent services.</p>
<p><strong>cache.cleaner.mixin.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">serviceNames</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> events = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    serviceNames.forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">        events[<span class="string">`cache.clean.<span class="subst">$&#123;name&#125;</span>`</span>] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.broker.cacher) &#123;</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">`Clear local '<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>' cache`</span>);</span><br><span class="line">                <span class="keyword">this</span>.broker.cacher.clean(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>.*`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        events</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><strong>posts.service.js</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> CacheCleaner = <span class="built_in">require</span>(<span class="string">"./cache.cleaner.mixin"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    name: <span class="string">"posts"</span>,</span><br><span class="line">    mixins: [CacheCleaner([<span class="string">"users"</span>, <span class="string">"posts"</span>])],</span><br><span class="line"></span><br><span class="line">    actions: &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>With this solution if the <code>users</code> service emits a <code>cache.clean.users</code> event, the <code>posts</code> service will also clear the own cache entries.</p>
<h2 id="Built-in-cachers" class="article-heading"><a href="#Built-in-cachers" class="headerlink" title="Built-in cachers"></a>Built-in cachers<a class="article-anchor" href="#Built-in-cachers" aria-hidden="true"></a></h2><h3 id="Memory-cacher" class="article-heading"><a href="#Memory-cacher" class="headerlink" title="Memory cacher"></a>Memory cacher<a class="article-anchor" href="#Memory-cacher" aria-hidden="true"></a></h3><p><code>MemoryCacher</code> is a built-in memory cache module. It stores entries in the heap memory.</p>
<p><strong>Enable memory cacher</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="string">"Memory"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>Or</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>Enable with options</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"Memory"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            ttl: <span class="number">30</span> <span class="comment">// Set Time-to-live to 30sec. Disabled: 0 or null</span></span><br><span class="line">            clone: <span class="literal">true</span> <span class="comment">// Deep-clone the returned value</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>Options</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ttl</code></td>
<td><code>Number</code></td>
<td><code>null</code></td>
<td>Time-to-live in seconds.</td>
</tr>
<tr>
<td><code>clone</code></td>
<td><code>Boolean</code> or <code>Function</code></td>
<td><code>false</code></td>
<td>Clone the cached data when return it.</td>
</tr>
<tr>
<td><code>keygen</code></td>
<td><code>Function</code></td>
<td><code>null</code></td>
<td>Custom cache key generator function.</td>
</tr>
<tr>
<td><code>maxParamsLength</code></td>
<td><code>Number</code></td>
<td><code>null</code></td>
<td>Maximum length of params in generated keys.</td>
</tr>
</tbody>
</table>
<h4 id="Cloning" class="article-heading"><a href="#Cloning" class="headerlink" title="Cloning"></a>Cloning<a class="article-anchor" href="#Cloning" aria-hidden="true"></a></h4><p>The cacher uses the lodash <code>_.cloneDeep</code> method for cloning. To change it, set a <code>Function</code> to the <code>clone</code> option instead of a <code>Boolean</code>.</p>
<p><strong>Custom clone function with JSON parse &amp; stringify</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"Memory"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            clone: <span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(data))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Redis-cacher" class="article-heading"><a href="#Redis-cacher" class="headerlink" title="Redis cacher"></a>Redis cacher<a class="article-anchor" href="#Redis-cacher" aria-hidden="true"></a></h3><p><code>RedisCacher</code> is a built-in <a href="https://redis.io/" target="_blank" rel="noopener">Redis</a> based distributed cache module. It uses <a href="https://github.com/luin/ioredis" target="_blank" rel="noopener"><code>ioredis</code></a> library.<br>Use it, if you have multiple instances of services because if one instance stores some data in the cache, other instances will find it.</p>
<p><strong>Enable Redis cacher</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="string">"Redis"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>With connection string</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="string">"redis://redis-server:6379"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>With options</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"Redis"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            <span class="comment">// Prefix for keys</span></span><br><span class="line">            prefix: <span class="string">"MOL"</span>,</span><br><span class="line">            <span class="comment">// set Time-to-live to 30sec.</span></span><br><span class="line">            ttl: <span class="number">30</span>,</span><br><span class="line">            <span class="comment">// Turns Redis client monitoring on.</span></span><br><span class="line">            monitor: <span class="literal">false</span></span><br><span class="line">            <span class="comment">// Redis settings</span></span><br><span class="line">            redis: &#123;</span><br><span class="line">                host: <span class="string">"redis-server"</span>,</span><br><span class="line">                port: <span class="number">6379</span>,</span><br><span class="line">                password: <span class="string">"1234"</span>,</span><br><span class="line">                db: <span class="number">0</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>Options</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>prefix</code></td>
<td><code>String</code></td>
<td><code>null</code></td>
<td>Prefix for generated keys.</td>
</tr>
<tr>
<td><code>ttl</code></td>
<td><code>Number</code></td>
<td><code>null</code></td>
<td>Time-to-live in seconds. Disabled: 0 or null</td>
</tr>
<tr>
<td><code>monitor</code></td>
<td><code>Boolean</code></td>
<td><code>false</code></td>
<td>Enable Redis client <a href="https://github.com/luin/ioredis#monitor" target="_blank" rel="noopener">monitoring feature</a>. If enabled, every client operation will be logged (on debug level)</td>
</tr>
<tr>
<td><code>redis</code></td>
<td><code>Object</code></td>
<td><code>null</code></td>
<td>Custom Redis options. Will be passed to the <code>new Redis()</code> constructor. <a href="https://github.com/luin/ioredis#connect-to-redis" target="_blank" rel="noopener">Read more</a>.</td>
</tr>
<tr>
<td><code>keygen</code></td>
<td><code>Function</code></td>
<td><code>null</code></td>
<td>Custom cache key generator function.</td>
</tr>
<tr>
<td><code>maxParamsLength</code></td>
<td><code>Number</code></td>
<td><code>null</code></td>
<td>Maximum length of params in generated keys.</td>
</tr>
</tbody>
</table>
<blockquote class="note info"><strong class="note-title">Dependencies</strong><p>To be able to use this cacher, install the <code>ioredis</code> module with the <code>npm install ioredis --save</code> command.</p>
</blockquote>
<h3 id="LRU-memory-cacher" class="article-heading"><a href="#LRU-memory-cacher" class="headerlink" title="LRU memory cacher"></a>LRU memory cacher<a class="article-anchor" href="#LRU-memory-cacher" aria-hidden="true"></a></h3><p><code>LRU memory cacher</code> is a built-in <a href="https://github.com/isaacs/node-lru-cache" target="_blank" rel="noopener">LRU cache</a> module. It deletes the least-recently-used items.</p>
<p><strong>Enable LRU cacher</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="string">"MemoryLRU"</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>With options</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    logLevel: <span class="string">"debug"</span>,</span><br><span class="line">    cacher: &#123;</span><br><span class="line">        type: <span class="string">"MemoryLRU"</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            <span class="comment">// Maximum items</span></span><br><span class="line">            max: <span class="number">100</span>,</span><br><span class="line">            <span class="comment">// Time-to-Live</span></span><br><span class="line">            ttl: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote class="note info"><strong class="note-title">Dependencies</strong><p>To be able to use this cacher, install the <code>lru-cache</code> module with the <code>npm install lru-cache --save</code> command.</p>
</blockquote>
<h2 id="Custom-cacher" class="article-heading"><a href="#Custom-cacher" class="headerlink" title="Custom cacher"></a>Custom cacher<a class="article-anchor" href="#Custom-cacher" aria-hidden="true"></a></h2><p>Custom cache module can be created. We recommend to copy the source of <a href="https://github.com/moleculer-go/moleculer/blob/master/src/cachers/memory.js" target="_blank" rel="noopener">MemoryCacher</a> or <a href="https://github.com/moleculer-go/moleculer/blob/master/src/cachers/redis.js" target="_blank" rel="noopener">RedisCacher</a> and implement the <code>get</code>, <code>set</code>, <code>del</code> and <code>clean</code> methods.</p>
<h3 id="Create-custom-cacher" class="article-heading"><a href="#Create-custom-cacher" class="headerlink" title="Create custom cacher"></a>Create custom cacher<a class="article-anchor" href="#Create-custom-cacher" aria-hidden="true"></a></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> BaseCacher = <span class="built_in">require</span>(<span class="string">"moleculer"</span>).Cachers.Base;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCacher</span> <span class="keyword">extends</span> <span class="title">BaseCacher</span> </span>&#123;</span><br><span class="line">    get(key) &#123;</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    set(key, data, ttl) &#123;</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    del(key) &#123;</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    &#125;</span><br><span class="line">    clean(match = <span class="string">"**"</span>) &#123;</span><br><span class="line">        <span class="comment">/*...*/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Use-custom-cacher" class="article-heading"><a href="#Use-custom-cacher" class="headerlink" title="Use custom cacher"></a>Use custom cacher<a class="article-anchor" href="#Use-custom-cacher" aria-hidden="true"></a></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ServiceBroker &#125; = <span class="built_in">require</span>(<span class="string">"moleculer"</span>);</span><br><span class="line"><span class="keyword">const</span> MyCacher = <span class="built_in">require</span>(<span class="string">"./my-cacher"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker(&#123;</span><br><span class="line">    cacher: <span class="keyword">new</span> MyCacher()</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2019-04-22T02:47:21.439Z" itemprop="dateModified">Last updated: 2019-04-22</time>
                <a href="fault-tolerance.html" class="article-footer-prev" title="Fault tolerance"><i class="fa fa-chevron-left"></i><span>Prev</span></a><a href="validating.html" class="article-footer-next" title="Validating"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Caching"><span class="toc-text">Caching</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Cache-keys"><span class="toc-text">Cache keys</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cache-meta-keys"><span class="toc-text">Cache meta keys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Limiting-cache-key-length"><span class="toc-text">Limiting cache key length</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Conditional-caching"><span class="toc-text">Conditional caching</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TTL"><span class="toc-text">TTL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-key-generator"><span class="toc-text">Custom key-generator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Manual-caching"><span class="toc-text">Manual caching</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Clear-cache"><span class="toc-text">Clear cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Clear-cache-among-multiple-service-instances"><span class="toc-text">Clear cache among multiple service instances</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Clear-cache-among-different-services"><span class="toc-text">Clear cache among different services</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Built-in-cachers"><span class="toc-text">Built-in cachers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Memory-cacher"><span class="toc-text">Memory cacher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis-cacher"><span class="toc-text">Redis cacher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LRU-memory-cacher"><span class="toc-text">LRU memory cacher</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-cacher"><span class="toc-text">Custom cacher</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-custom-cacher"><span class="toc-text">Create custom cacher</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Use-custom-cacher"><span class="toc-text">Use custom cacher</span></a></li></ol></li></ol></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner"><div class="version-selector"><select onchange="changeVersion(this)"><option value="docs/0.1" selected>v0.1</option></select></div><strong class="sidebar-title">Introduction</strong><a href="/docs/0.1/index.html" class="sidebar-link">What is Moleculer?</a><a href="/docs/0.1/usage.html" class="sidebar-link">Usage</a><a href="/docs/0.1/examples.html" class="sidebar-link">Examples</a><strong class="sidebar-title">Overview</strong><a href="/docs/0.1/broker.html" class="sidebar-link">Broker</a><a href="/docs/0.1/services.html" class="sidebar-link">Services</a><a href="/docs/0.1/actions.html" class="sidebar-link">Actions</a><a href="/docs/0.1/events.html" class="sidebar-link">Events</a><a href="/docs/0.1/lifecycle.html" class="sidebar-link">Lifecycles</a><a href="/docs/0.1/logging.html" class="sidebar-link">Logging</a><a href="/docs/0.1/middlewares.html" class="sidebar-link">Middlewares</a><a href="/docs/0.1/networking.html" class="sidebar-link">Networking</a><a href="/docs/0.1/registry.html" class="sidebar-link">Discovery & Registry</a><a href="/docs/0.1/balancing.html" class="sidebar-link">Load balancing</a><a href="/docs/0.1/fault-tolerance.html" class="sidebar-link">Fault tolerance</a><a href="/docs/0.1/caching.html" class="sidebar-link current">Caching</a><a href="/docs/0.1/validating.html" class="sidebar-link">Validating</a><a href="/docs/0.1/metrics.html" class="sidebar-link">Metrics & Tracing</a><a href="/docs/0.1/errors.html" class="sidebar-link">Errors</a><a href="/docs/0.1/runner.html" class="sidebar-link">Moleculer Runner</a><strong class="sidebar-title">Modules</strong><a href="/docs/0.1/gateway.html" class="sidebar-link">API Gateway</a><a href="/docs/0.1/moleculer-repl.html" class="sidebar-link">REPL console</a><a href="/docs/0.1/moleculer-cli.html" class="sidebar-link">CLI Tool</a><a href="/docs/0.1/store.html" class="sidebar-link">DB Adapters</a><a href="/modules.html" class="sidebar-link">All modules</a><strong class="sidebar-title">Miscellaneous</strong><a href="/docs/0.1/clustering.html" class="sidebar-link">Clustering</a><a href="/docs/0.1/deploying.html" class="sidebar-link">Deploying</a><a href="/docs/0.1/benchmark.html" class="sidebar-link">Benchmark</a><a href="/docs/0.1/faq.html" class="sidebar-link">FAQ</a><a href="/docs/0.1/contributing.html" class="sidebar-link">Contributing</a><strong class="sidebar-title">API</strong><a href="/docs/0.1/api/service-broker.html" class="sidebar-link">ServiceBroker</a><a href="/docs/0.1/api/service.html" class="sidebar-link">Service</a><a href="/docs/0.1/api/context.html" class="sidebar-link">Context</a><a href="/docs/0.1/api/protocol.html" class="sidebar-link">Protocol</a></div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      Copyright &copy; 2018-2019 <a href="https://github.com/pentateu" target="_blank">MoleculerGO</a><br>
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
    </div>
    <div id="footer-links">
      <a href="https://gitter.im/moleculer-go/moleculer" class="footer-link" target="_blank"><i class="fa fa-comments-o"></i></a>
      <a href="https://twitter.com/MoleculerG" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="https://github.com/moleculer-go/moleculer" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
      <a href="https://stackoverflow.com/questions/tagged/moleculer-go" class="footer-link" target="_blank"><i class="fa fa-stack-overflow"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/docs/0.1/" class="mobile-nav-link">Documentation</a><a href="/modules.html" class="mobile-nav-link">Modules</a><a href="/support.html" class="mobile-nav-link">Support</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/moleculer-go/moleculer" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <div class="version-selector"><select onchange="changeVersion(this)"><option value="docs/0.1" selected>v0.1</option></select></div><strong class="mobile-nav-title">Introduction</strong><a href="/docs/0.1/index.html" class="mobile-nav-link">What is Moleculer?</a><a href="/docs/0.1/usage.html" class="mobile-nav-link">Usage</a><a href="/docs/0.1/examples.html" class="mobile-nav-link">Examples</a><strong class="mobile-nav-title">Overview</strong><a href="/docs/0.1/broker.html" class="mobile-nav-link">Broker</a><a href="/docs/0.1/services.html" class="mobile-nav-link">Services</a><a href="/docs/0.1/actions.html" class="mobile-nav-link">Actions</a><a href="/docs/0.1/events.html" class="mobile-nav-link">Events</a><a href="/docs/0.1/lifecycle.html" class="mobile-nav-link">Lifecycles</a><a href="/docs/0.1/logging.html" class="mobile-nav-link">Logging</a><a href="/docs/0.1/middlewares.html" class="mobile-nav-link">Middlewares</a><a href="/docs/0.1/networking.html" class="mobile-nav-link">Networking</a><a href="/docs/0.1/registry.html" class="mobile-nav-link">Discovery & Registry</a><a href="/docs/0.1/balancing.html" class="mobile-nav-link">Load balancing</a><a href="/docs/0.1/fault-tolerance.html" class="mobile-nav-link">Fault tolerance</a><a href="/docs/0.1/caching.html" class="mobile-nav-link current">Caching</a><a href="/docs/0.1/validating.html" class="mobile-nav-link">Validating</a><a href="/docs/0.1/metrics.html" class="mobile-nav-link">Metrics & Tracing</a><a href="/docs/0.1/errors.html" class="mobile-nav-link">Errors</a><a href="/docs/0.1/runner.html" class="mobile-nav-link">Moleculer Runner</a><strong class="mobile-nav-title">Modules</strong><a href="/docs/0.1/gateway.html" class="mobile-nav-link">API Gateway</a><a href="/docs/0.1/moleculer-repl.html" class="mobile-nav-link">REPL console</a><a href="/docs/0.1/moleculer-cli.html" class="mobile-nav-link">CLI Tool</a><a href="/docs/0.1/store.html" class="mobile-nav-link">DB Adapters</a><a href="/modules.html" class="mobile-nav-link">All modules</a><strong class="mobile-nav-title">Miscellaneous</strong><a href="/docs/0.1/clustering.html" class="mobile-nav-link">Clustering</a><a href="/docs/0.1/deploying.html" class="mobile-nav-link">Deploying</a><a href="/docs/0.1/benchmark.html" class="mobile-nav-link">Benchmark</a><a href="/docs/0.1/faq.html" class="mobile-nav-link">FAQ</a><a href="/docs/0.1/contributing.html" class="mobile-nav-link">Contributing</a><strong class="mobile-nav-title">API</strong><a href="/docs/0.1/api/service-broker.html" class="mobile-nav-link">ServiceBroker</a><a href="/docs/0.1/api/service.html" class="mobile-nav-link">Service</a><a href="/docs/0.1/api/context.html" class="mobile-nav-link">Context</a><a href="/docs/0.1/api/protocol.html" class="mobile-nav-link">Protocol</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/js/lang_select.js"></script>
<script src="/js/version_select.js"></script>
<script src="/js/scrollingelement.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/mobile_nav.js"></script>
<!-- endbuild -->
<script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script>

<!-- Algolia -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: '7d5514b7c3e161a428f04f33ba1bdab4',
indexName: 'moleculer',
inputSelector: '#search-input',
algoliaOptions: { 'facetFilters': ["version:0.1"] },
debug: false // Set debug to true if you want to inspect the dropdown
});
</script>


<!-- fastclick -->
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  FastClick.attach(document.body)
}, false)
</script>

<!-- Gitter Chat -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'moleculer-go/moleculer'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
</body>
</html>