<!DOCTYPE html>
<html lang="en">
<head prefix="og: http://ogp.me/ns#"><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <title>Moleculer Go - Progressive microservices framework in Go</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="keywords" content="microservices, nodejs, node.js, javascript, github, opensource, framework, moleculer, github, scaling">
  <meta name="description" content="Moleculer is a fast, scalable and powerful microservices framework for Node.js.">
  <meta name="robots" content="index, follow">
  <!-- Canonical links -->
  <link rel="canonical" href="https://gomicro.services/docs/0.1/moleculer-web.html">
  <!-- Alternative links -->
  
    
      <link rel="alternative" hreflang="en" href="https://gomicro.services/docs/0.1/moleculer-web.html">
    
  
  <!-- Icon -->
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/icon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/icon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/icon/favicon-32x32.png" sizes="32x32">
  <meta name="msapplication-TileColor" content="#2f83cd">
  <meta name="msapplication-TileImage" content="/icon/mstile-144x144.png">
  <!-- CSS -->
  <!-- build:css build/css/moleculer.css -->
  <link rel="stylesheet" href="/css/moleculer.css">
  <!-- endbuild -->
  <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700|Roboto Mono|Lato:300,400,700" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css">
  <!-- RSS
  <link rel="alternate" href="/atom.xml" title="Moleculer Go - Progressive microservices framework in Go">
  -->
  <!-- Open Graph -->
  <meta name="description" content="API Gateway moleculer-web The moleculer-web is the official API gateway service for Moleculer framework. Use it to publish your services as RESTful APIs. Features support HTTP &amp;amp; HTTPS serve static">
<meta property="og:type" content="website">
<meta property="og:title" content="Moleculer Go - Progressive microservices framework in Go">
<meta property="og:url" content="https://gomicro.services/docs/0.1/moleculer-web.html">
<meta property="og:site_name" content="Moleculer Go - Progressive microservices framework in Go">
<meta property="og:description" content="API Gateway moleculer-web The moleculer-web is the official API gateway service for Moleculer framework. Use it to publish your services as RESTful APIs. Features support HTTP &amp;amp; HTTPS serve static">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://img.shields.io/npm/v/moleculer-web.svg?maxAge=3600">
<meta property="og:updated_time" content="2019-04-20T06:16:01.835Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Moleculer Go - Progressive microservices framework in Go">
<meta name="twitter:description" content="API Gateway moleculer-web The moleculer-web is the official API gateway service for Moleculer framework. Use it to publish your services as RESTful APIs. Features support HTTP &amp;amp; HTTPS serve static">
<meta name="twitter:image" content="https://img.shields.io/npm/v/moleculer-web.svg?maxAge=3600">
<meta name="twitter:site" content="MoleculerG">
  <!-- Google Analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-99099811-1', 'auto');
  ga('send', 'pageview');
</script>


  <!-- Particles -->
  <script src="/js/buttons.js"></script>

</head>

<body>
  <div id="particles-js"></div>
  <header id="header" class="wrapper">
  <div id="header-inner" class="inner">
    <h1 id="logo-wrap">
      <a href="/" id="logo">Moleculer</a>
    </h1>
    <nav id="main-nav">
      <a href="/docs/0.1/" class="main-nav-link">Documentation</a><a href="/modules.html" class="main-nav-link">Modules</a><a href="/support.html" class="main-nav-link">Support</a>
      <a href="https://github.com/moleculer-go/moleculer" class="main-nav-link">Github</a>
      <a href="https://gitter.im/moleculer-go/moleculer" class="main-nav-link">Chat</a>
      <a href="https://medium.com/moleculer" class="main-nav-link">Blog</a>
      <div id="search-input-wrap" class="on">
        <div id="search-input-icon">
          <i class="fa fa-search"></i>
        </div>
        <input type="search" id="search-input" placeholder="Search...">
      </div>
    </nav>
    <div id="lang-select-wrap" style="display: none">
      <label id="lang-select-label"><i class="fa fa-globe"></i><span>English</span></label>
      <select id="lang-select" data-canonical="">
        
          <option value="en" selected>English</option>
        
      </select>
    </div>
    <a id="mobile-nav-toggle">
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
      <span class="mobile-nav-toggle-bar"></span>
    </a>
  </div>
</header>

  <div id="container">
    <div id="content-wrap">
  <div id="content" class="wrapper">
    <div id="content-inner">
      <article class="article-container" itemscope="" itemtype="http://schema.org/Article">
        <div class="article-inner">
          <div class="article">
            <div class="inner">
              <div class="article-content" itemprop="articleBody">
                <a href="https://github.com/moleculer-go/site/edit/master/source/docs/0.1/moleculer-web.md" class="corner-right article-edit-link" title="Improve this doc"><i class="fa fa-pencil"></i></a>
                <h1 id="API-Gateway" class="article-heading"><a href="#API-Gateway" class="headerlink" title="API Gateway"></a>API Gateway<a class="article-anchor" href="#API-Gateway" aria-hidden="true"></a></h1><hr>
<h2 id="moleculer-web" class="article-heading"><a href="#moleculer-web" class="headerlink" title="moleculer-web "></a>moleculer-web <a href="https://www.npmjs.com/package/moleculer-web" target="_blank" rel="noopener"><img src="https://img.shields.io/npm/v/moleculer-web.svg?maxAge=3600" alt="npm"></a><a class="article-anchor" href="#moleculer-web" aria-hidden="true"></a></h2><p>The <a href="https://github.com/moleculer-go/moleculer-web" target="_blank" rel="noopener">moleculer-web</a> is the official API gateway service for Moleculer framework. Use it to publish your services as RESTful APIs.</p>
<h2 id="Features" class="article-heading"><a href="#Features" class="headerlink" title="Features"></a>Features<a class="article-anchor" href="#Features" aria-hidden="true"></a></h2><ul>
<li>support HTTP &amp; HTTPS</li>
<li>serve static files</li>
<li>multiple routes</li>
<li>support Connect-like middlewares in global-level, route-level and alias-level.</li>
<li>alias names (with named parameters &amp; REST routes)</li>
<li>whitelist</li>
<li>multiple body parsers (json, urlencoded)</li>
<li>CORS headers</li>
<li>Rate limiter</li>
<li>before &amp; after call hooks</li>
<li>Buffer &amp; Stream handling</li>
<li>middleware mode (use as a middleware with Express)</li>
</ul>
<h2 id="Install" class="article-heading"><a href="#Install" class="headerlink" title="Install"></a>Install<a class="article-anchor" href="#Install" aria-hidden="true"></a></h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">npm i moleculer-web</span><br></pre></td></tr></table></figure>
<h2 id="Usage" class="article-heading"><a href="#Usage" class="headerlink" title="Usage"></a>Usage<a class="article-anchor" href="#Usage" aria-hidden="true"></a></h2><h3 id="Run-with-default-settings" class="article-heading"><a href="#Run-with-default-settings" class="headerlink" title="Run with default settings"></a>Run with default settings<a class="article-anchor" href="#Run-with-default-settings" aria-hidden="true"></a></h3><p>This example uses API Gateway service with default settings.<br>You can access all services (including internal <code>$node.</code>) via <code>http://localhost:3000/</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; ServiceBroker &#125; = <span class="built_in">require</span>(<span class="string">"moleculer"</span>);</span><br><span class="line"><span class="keyword">const</span> ApiService = <span class="built_in">require</span>(<span class="string">"moleculer-web"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> broker = <span class="keyword">new</span> ServiceBroker();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Load API Gateway</span></span><br><span class="line">broker.createService(ApiService);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start server</span></span><br><span class="line">broker.start();</span><br></pre></td></tr></table></figure>
<p><strong>Example URLs:</strong></p>
<ul>
<li>Call <code>test.hello</code> action: <code>http://localhost:3000/test/hello</code></li>
<li><p>Call <code>math.add</code> action with params: <code>http://localhost:3000/math/add?a=25&amp;b=13</code></p>
</li>
<li><p>Get health info of node: <code>http://localhost:3000/~node/health</code></p>
</li>
<li>List all actions: <code>http://localhost:3000/~node/actions</code></li>
</ul>
<h2 id="Whitelist" class="article-heading"><a href="#Whitelist" class="headerlink" title="Whitelist"></a>Whitelist<a class="article-anchor" href="#Whitelist" aria-hidden="true"></a></h2><p>If you don’t want to publish all actions, you can filter them with whitelist option.<br>Use match strings or regexp in list. <em>To enable all actions, use <code>&quot;**&quot;</code> item.</em></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/api"</span>,</span><br><span class="line"></span><br><span class="line">                whitelist: [</span><br><span class="line">                    <span class="comment">// Access any actions in 'posts' service</span></span><br><span class="line">                    <span class="string">"posts.*"</span>,</span><br><span class="line">                    <span class="comment">// Access call only the `users.list` action</span></span><br><span class="line">                    <span class="string">"users.list"</span>,</span><br><span class="line">                    <span class="comment">// Access any actions in 'math' service</span></span><br><span class="line">                    /^math\.\w+$/</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Aliases" class="article-heading"><a href="#Aliases" class="headerlink" title="Aliases"></a>Aliases<a class="article-anchor" href="#Aliases" aria-hidden="true"></a></h2><p>You can use alias names instead of action names. You can also specify the method. Otherwise it will handle every method types.</p>
<p>Using named parameters in aliases is possible. Named parameters are defined by prefixing a colon to the parameter name (<code>:name</code>).</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                aliases: &#123;</span><br><span class="line">                    <span class="comment">// Call `auth.login` action with `GET /login` or `POST /login`</span></span><br><span class="line">                    login: <span class="string">"auth.login"</span>,</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Restrict the request method</span></span><br><span class="line">                    <span class="string">"POST users"</span>: <span class="string">"users.create"</span>,</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// The `name` comes from named param.</span></span><br><span class="line">                    <span class="comment">// You can access it with `ctx.params.name` in action</span></span><br><span class="line">                    <span class="string">"GET greeter/:name"</span>: <span class="string">"test.greeter"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote class="note info"><p>The named parameter is handled with <a href="https://github.com/pillarjs/path-to-regexp" target="_blank" rel="noopener">path-to-regexp</a> module. Therefore you can use <a href="https://github.com/pillarjs/path-to-regexp#optional" target="_blank" rel="noopener">optional</a> and <a href="https://github.com/pillarjs/path-to-regexp#zero-or-more" target="_blank" rel="noopener">repeated</a> parameters, as well.</p>
</blockquote>
<p>You can also create RESTful APIs.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                aliases: &#123;</span><br><span class="line">                    <span class="string">"GET users"</span>: <span class="string">"users.list"</span>,</span><br><span class="line">                    <span class="string">"GET users/:id"</span>: <span class="string">"users.get"</span>,</span><br><span class="line">                    <span class="string">"POST users"</span>: <span class="string">"users.create"</span>,</span><br><span class="line">                    <span class="string">"PUT users/:id"</span>: <span class="string">"users.update"</span>,</span><br><span class="line">                    <span class="string">"DELETE users/:id"</span>: <span class="string">"users.remove"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>For REST routes you can also use this simple shorthand alias:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                aliases: &#123;</span><br><span class="line">                    <span class="string">"REST users"</span>: <span class="string">"users"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote class="note warn"><p>To use this shorthand alias, create a service which has <code>list</code>, <code>get</code>, <code>create</code>, <code>update</code> and <code>remove</code> actions.</p>
</blockquote>
<p>You can make use of custom functions within the declaration of aliases.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                aliases: &#123;</span><br><span class="line">                    <span class="string">"POST upload"</span>(req, res) &#123;</span><br><span class="line">                        <span class="keyword">this</span>.parseUploadedFile(req, res);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote class="note info"><p>There are some internal pointer in <code>req</code> &amp; <code>res</code> objects:</p>
<ul>
<li><code>req.$ctx</code> are pointed to request context.</li>
<li><code>req.$service</code> &amp; <code>res.$service</code> are pointed to this service instance.</li>
<li><code>req.$route</code> &amp; <code>res.$route</code> are pointed to the resolved route definition.</li>
<li><code>req.$params</code> is pointed to the resolved parameters (from query string &amp; post body)</li>
<li><code>req.$alias</code> is pointed to the resolved alias definition.</li>
<li><code>req.$action</code> is pointed to the resolved action.</li>
<li><code>req.$endpoint</code> is pointed to the resolved action endpoint.</li>
<li><code>req.$next</code> is pointed to the <code>next()</code> handler if the request comes from ExpressJS.</li>
</ul>
<p>E.g.: To access the broker, use <code>req.$service.broker</code>.</p>
</blockquote>
<h3 id="Mapping-policy" class="article-heading"><a href="#Mapping-policy" class="headerlink" title="Mapping policy"></a>Mapping policy<a class="article-anchor" href="#Mapping-policy" aria-hidden="true"></a></h3><p>The <code>route</code> has a <code>mappingPolicy</code> property to handle routes without aliases.</p>
<p><strong>Available options:</strong></p>
<ul>
<li><code>all</code> - enable to request all routes with or without aliases (default)</li>
<li><code>restrict</code> - enable to request only the routes with aliases.</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                mappingPolicy: <span class="string">"restrict"</span>,</span><br><span class="line">                aliases: &#123;</span><br><span class="line">                    <span class="string">"POST add"</span>: <span class="string">"math.add"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>You can’t request the <code>/math.add</code> or <code>/math/add</code> URLs, only <code>POST /add</code>.</p>
<h2 id="Parameters" class="article-heading"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters<a class="article-anchor" href="#Parameters" aria-hidden="true"></a></h2><p>API gateway collects parameters from URL querystring, request params &amp; request body and merges them. The results is placed to the <code>req.$params</code>.</p>
<h3 id="Disable-merging" class="article-heading"><a href="#Disable-merging" class="headerlink" title="Disable merging"></a>Disable merging<a class="article-anchor" href="#Disable-merging" aria-hidden="true"></a></h3><p>To disable parameter merging set <code>mergeParams: false</code> in route settings. In this case the parameters is separated.</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/"</span>,</span><br><span class="line">                mergeParams: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>Un-merged <code>req.$params</code>:</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Querystring params</span></span><br><span class="line">    query: &#123;</span><br><span class="line">        category: <span class="string">"general"</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Request body content</span></span><br><span class="line">    body: &#123;</span><br><span class="line">        # "Hello",</span><br><span class="line">        content: <span class="string">"..."</span>,</span><br><span class="line">        createdAt: <span class="number">1530796920203</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Request params</span></span><br><span class="line">    params: &#123;</span><br><span class="line">        id: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Query-string-parameters" class="article-heading"><a href="#Query-string-parameters" class="headerlink" title="Query string parameters"></a>Query string parameters<a class="article-anchor" href="#Query-string-parameters" aria-hidden="true"></a></h3><p>More information: <a href="https://github.com/ljharb/qs" target="_blank" rel="noopener">https://github.com/ljharb/qs</a></p>
<p><strong>Array parameters</strong><br>URL: <code>GET /api/opt-test?a=1&amp;a=2</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">a: [<span class="string">"1"</span>, <span class="string">"2"</span>];</span><br></pre></td></tr></table></figure>
<p><strong>Nested objects &amp; arrays</strong><br>URL: <code>GET /api/opt-test?foo[bar]=a&amp;foo[bar]=b&amp;foo[baz]=c</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">foo: &#123;</span><br><span class="line">    bar: [<span class="string">"a"</span>, <span class="string">"b"</span>],</span><br><span class="line">    baz: <span class="string">"c"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Middlewares" class="article-heading"><a href="#Middlewares" class="headerlink" title="Middlewares"></a>Middlewares<a class="article-anchor" href="#Middlewares" aria-hidden="true"></a></h2><p>It supports Connect-like middlewares in global-level, route-level &amp; alias-level. Signature: <code>function(req, res, next) {...}</code>.</p>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line">    settings: &#123;</span><br><span class="line">        <span class="comment">// Global middlewares. Applied to all routes.</span></span><br><span class="line">        use: [cookieParser(), helmet()],</span><br><span class="line"></span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/"</span>,</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Route-level middlewares.</span></span><br><span class="line">                use: [</span><br><span class="line">                    compression(),</span><br><span class="line"></span><br><span class="line">                    passport.initialize(),</span><br><span class="line">                    passport.session(),</span><br><span class="line"></span><br><span class="line">                    serveStatic(path.join(__dirname, <span class="string">"public"</span>))</span><br><span class="line">                ],</span><br><span class="line"></span><br><span class="line">                aliases: &#123;</span><br><span class="line">                    <span class="string">"GET /secret"</span>: [</span><br><span class="line">                        <span class="comment">// Alias-level middlewares.</span></span><br><span class="line">                        auth.isAuthenticated(),</span><br><span class="line">                        auth.hasRole(<span class="string">"admin"</span>),</span><br><span class="line">                        <span class="string">"top.secret"</span> <span class="comment">// Call the `top.secret` action</span></span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Error-handler-middleware" class="article-heading"><a href="#Error-handler-middleware" class="headerlink" title="Error-handler middleware"></a>Error-handler middleware<a class="article-anchor" href="#Error-handler-middleware" aria-hidden="true"></a></h3><p>There is support to use error-handler middlewares in the API Gateway. So if you pass an <code>Error</code> to the <code>next(err)</code> function, it will call error handler middlewares which have signature as <code>(err, req, res, next)</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line">    settings: &#123;</span><br><span class="line">        <span class="comment">// Global middlewares. Applied to all routes.</span></span><br><span class="line">        use: [</span><br><span class="line">            cookieParser(),</span><br><span class="line">            helmet()</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/"</span>,</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Route-level middlewares.</span></span><br><span class="line">                use: [</span><br><span class="line">                    compression(),</span><br><span class="line"></span><br><span class="line">                    passport.initialize(),</span><br><span class="line">                    passport.session(),</span><br><span class="line"></span><br><span class="line">                    <span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">this</span>.logger.error(<span class="string">"Error is occured in middlewares!"</span>);</span><br><span class="line">                        <span class="keyword">this</span>.sendError(req, res, err);</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br></pre></td></tr></table></figure>
<h2 id="Serve-static-files" class="article-heading"><a href="#Serve-static-files" class="headerlink" title="Serve static files"></a>Serve static files<a class="article-anchor" href="#Serve-static-files" aria-hidden="true"></a></h2><p>It serves assets with the <a href="https://github.com/expressjs/serve-static" target="_blank" rel="noopener">serve-static</a> module like ExpressJS.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        assets: &#123;</span><br><span class="line">            <span class="comment">// Root folder of assets</span></span><br><span class="line">            folder: <span class="string">"./assets"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Further options to `server-static` module</span></span><br><span class="line">            options: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Calling-options" class="article-heading"><a href="#Calling-options" class="headerlink" title="Calling options"></a>Calling options<a class="article-anchor" href="#Calling-options" aria-hidden="true"></a></h2><p>The <code>route</code> has a <code>callOptions</code> property which is passed to <code>broker.call</code>. So you can set <code>timeout</code>, <code>retries</code> or <code>fallbackResponse</code> options for routes. <a href="actions.html#Call-services">Read more about calling options</a></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [&#123;</span><br><span class="line"></span><br><span class="line">            callOptions: &#123;</span><br><span class="line">                timeout: <span class="number">500</span>,</span><br><span class="line">                retries: <span class="number">3</span>,</span><br><span class="line">                fallbackResponse(ctx, err) &#123; ... &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Multiple-routes" class="article-heading"><a href="#Multiple-routes" class="headerlink" title="Multiple routes"></a>Multiple routes<a class="article-anchor" href="#Multiple-routes" aria-hidden="true"></a></h2><p>You can create multiple routes with different prefix, whitelist, alias, calling options &amp; authorization.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/admin"</span>,</span><br><span class="line"></span><br><span class="line">                authorization: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">                whitelist: [<span class="string">"$node.*"</span>, <span class="string">"users.*"</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/"</span>,</span><br><span class="line"></span><br><span class="line">                whitelist: [<span class="string">"posts.*"</span>, <span class="string">"math.*"</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Response-type-amp-status-code" class="article-heading"><a href="#Response-type-amp-status-code" class="headerlink" title="Response type &amp; status code"></a>Response type &amp; status code<a class="article-anchor" href="#Response-type-amp-status-code" aria-hidden="true"></a></h2><p>When the response is received from an action handler, the API gateway detects the type of response and set the <code>Content-Type</code> in the <code>res</code> headers. The status code is <code>200</code> by default. Of course you can overwrite these values, moreover, you can define custom response headers, too.</p>
<p>To define response headers &amp; status code use <code>ctx.meta</code> fields:</p>
<p><strong>Available meta fields:</strong></p>
<ul>
<li><code>ctx.meta.$statusCode</code> - set <code>res.statusCode</code>.</li>
<li><code>ctx.meta.$statusMessage</code> - set <code>res.statusMessage</code>.</li>
<li><code>ctx.meta.$responseType</code> - set <code>Content-Type</code> in header.</li>
<li><code>ctx.meta.$responseHeaders</code> - set all keys in header.</li>
<li><code>ctx.meta.$location</code> - set <code>Location</code> key in header for redirects.</li>
</ul>
<p><strong>Example</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    name: <span class="string">"export"</span>,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        <span class="comment">// Download response as a file in the browser</span></span><br><span class="line">        downloadCSV(ctx) &#123;</span><br><span class="line">            ctx.meta.$responseType = <span class="string">"text/csv"</span>;</span><br><span class="line">            ctx.meta.$responseHeaders = &#123;</span><br><span class="line">                <span class="string">"Content-Disposition"</span>: <span class="string">`attachment; filename="data-<span class="subst">$&#123;ctx.params.id&#125;</span>.csv"`</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> csvFileStream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Redirect the request</span></span><br><span class="line">        redirectSample(ctx) &#123;</span><br><span class="line">            ctx.meta.$statusCode = <span class="number">302</span>;</span><br><span class="line">            ctx.meta.$location = <span class="string">"/login"</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Authorization" class="article-heading"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization<a class="article-anchor" href="#Authorization" aria-hidden="true"></a></h2><p>You can implement authorization. Do 2 things to enable it.</p>
<ol>
<li>Set <code>authorization: true</code> in your routes</li>
<li>Define the <code>authorize</code> method in service.</li>
</ol>
<p><strong>Example authorization</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> E = <span class="built_in">require</span>(<span class="string">"moleculer-web"</span>).Errors;</span><br><span class="line"></span><br><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [&#123;</span><br><span class="line">            <span class="comment">// First thing</span></span><br><span class="line">            authorization: <span class="literal">true</span></span><br><span class="line">        &#125;]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">        <span class="comment">// Second thing</span></span><br><span class="line">        authorize(ctx, route, req, res) &#123;</span><br><span class="line">            <span class="comment">// Read the token from header</span></span><br><span class="line">            <span class="keyword">let</span> auth = req.headers[<span class="string">"authorization"</span>];</span><br><span class="line">            <span class="keyword">if</span> (auth &amp;&amp; auth.startsWith(<span class="string">"Bearer"</span>)) &#123;</span><br><span class="line">                <span class="keyword">let</span> token = auth.slice(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Check the token</span></span><br><span class="line">                <span class="keyword">if</span> (token == <span class="string">"123456"</span>) &#123;</span><br><span class="line">                    <span class="comment">// Set the authorized user entity to `ctx.meta`</span></span><br><span class="line">                    ctx.meta.user = &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">"John Doe"</span> &#125;;</span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(ctx);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// Invalid token</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> E.UnAuthorizedError(E.ERR_INVALID_TOKEN));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// No token</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> E.UnAuthorizedError(E.ERR_NO_TOKEN));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote class="note info"><p>You can find a more detailed role-based JWT authorization example in <a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/full/index.js#L239" target="_blank" rel="noopener">full example</a>.</p>
</blockquote>
<h2 id="Authentication" class="article-heading"><a href="#Authentication" class="headerlink" title="Authentication"></a>Authentication<a class="article-anchor" href="#Authentication" aria-hidden="true"></a></h2><p>To enable the support for authentication, you need to do something similar to what is describe in the Authorization paragraph. Also in this case you have to:</p>
<ol>
<li>Set <code>authentication: true</code> in your routes</li>
<li>Define your custom <code>authenticate</code> method in your service</li>
</ol>
<p><strong>Example authentication</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: ApiGatewayService,</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// Enable authentication</span></span><br><span class="line">                authentication: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    methods: &#123;</span><br><span class="line">        authenticate(ctx, route, req, res) &#123;</span><br><span class="line">            <span class="keyword">let</span> accessToken = req.query[<span class="string">"access_token"</span>];</span><br><span class="line">            <span class="keyword">if</span> (accessToken) &#123;</span><br><span class="line">                <span class="keyword">if</span> (accessToken === <span class="string">"12345"</span>) &#123;</span><br><span class="line">                    <span class="comment">// valid credentials</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(&#123;</span><br><span class="line">                        id: <span class="number">1</span>,</span><br><span class="line">                        username: <span class="string">"john.doe"</span>,</span><br><span class="line">                        name: <span class="string">"John Doe"</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">// invalid credentials</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// anonymous user</span></span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Route-hooks" class="article-heading"><a href="#Route-hooks" class="headerlink" title="Route hooks"></a>Route hooks<a class="article-anchor" href="#Route-hooks" aria-hidden="true"></a></h2><p>The <code>route</code> has before &amp; after call hooks. You can use it to set <code>ctx.meta</code>, access <code>req.headers</code> or modify the response <code>data</code>.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/"</span>,</span><br><span class="line"></span><br><span class="line">                onBeforeCall(ctx, route, req, res) &#123;</span><br><span class="line">                    <span class="comment">// Set request headers to context meta</span></span><br><span class="line">                    ctx.meta.userAgent = req.headers[<span class="string">"user-agent"</span>];</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">                onAfterCall(ctx, route, req, res, data) &#123;</span><br><span class="line">                    <span class="comment">// Async function which return with Promise</span></span><br><span class="line">                    <span class="keyword">return</span> doSomething(ctx, res, data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>In previous versions of Moleculer Web, you couldn’t manipulate the <code>data</code> in <code>onAfterCall</code>. Now you can, but you must always return the new or original <code>data</code>.</p>
</blockquote>
<h2 id="Error-handlers" class="article-heading"><a href="#Error-handlers" class="headerlink" title="Error handlers"></a>Error handlers<a class="article-anchor" href="#Error-handlers" aria-hidden="true"></a></h2><p>You can add route-level &amp; global-level custom error handlers.</p>
<blockquote>
<p>In handlers, you must call the <code>res.end</code>. Otherwise, the request is unhandled.</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line">    settings: &#123;</span><br><span class="line"></span><br><span class="line">        routes: [&#123;</span><br><span class="line">            path: <span class="string">"/api"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Route error handler</span></span><br><span class="line">            onError(req, res, err) &#123;</span><br><span class="line">                res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json; charset=utf-8"</span>);</span><br><span class="line">                res.writeHead(<span class="number">500</span>);</span><br><span class="line">                res.end(<span class="built_in">JSON</span>.stringify(err));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;],</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Global error handler</span></span><br><span class="line">        onError(req, res, err) &#123;</span><br><span class="line">            res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">            res.writeHead(<span class="number">501</span>);</span><br><span class="line">            res.end(<span class="string">"Global error: "</span> + err.message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="CORS-headers" class="article-heading"><a href="#CORS-headers" class="headerlink" title="CORS headers"></a>CORS headers<a class="article-anchor" href="#CORS-headers" aria-hidden="true"></a></h2><p>You can use <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank" rel="noopener">CORS</a> headers in Moleculer-Web service.</p>
<p><strong>Usage</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> svc = broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        <span class="comment">// Global CORS settings for all routes</span></span><br><span class="line">        cors: &#123;</span><br><span class="line">            <span class="comment">// Configures the Access-Control-Allow-Origin CORS header.</span></span><br><span class="line">            origin: <span class="string">"*"</span>,</span><br><span class="line">            <span class="comment">// Configures the Access-Control-Allow-Methods CORS header.</span></span><br><span class="line">            methods: [<span class="string">"GET"</span>, <span class="string">"OPTIONS"</span>, <span class="string">"POST"</span>, <span class="string">"PUT"</span>, <span class="string">"DELETE"</span>],</span><br><span class="line">            <span class="comment">// Configures the Access-Control-Allow-Headers CORS header.</span></span><br><span class="line">            allowedHeaders: [],</span><br><span class="line">            <span class="comment">// Configures the Access-Control-Expose-Headers CORS header.</span></span><br><span class="line">            exposedHeaders: [],</span><br><span class="line">            <span class="comment">// Configures the Access-Control-Allow-Credentials CORS header.</span></span><br><span class="line">            credentials: <span class="literal">false</span>,</span><br><span class="line">            <span class="comment">// Configures the Access-Control-Max-Age CORS header.</span></span><br><span class="line">            maxAge: <span class="number">3600</span></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">"/api"</span>,</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Route CORS settings (overwrite global settings)</span></span><br><span class="line">                cors: &#123;</span><br><span class="line">                    origin: [<span class="string">"http://localhost:3000"</span>, <span class="string">"https://localhost:4000"</span>],</span><br><span class="line">                    methods: [<span class="string">"GET"</span>, <span class="string">"OPTIONS"</span>, <span class="string">"POST"</span>],</span><br><span class="line">                    credentials: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Rate-limiter" class="article-heading"><a href="#Rate-limiter" class="headerlink" title="Rate limiter"></a>Rate limiter<a class="article-anchor" href="#Rate-limiter" aria-hidden="true"></a></h2><p>The Moleculer-Web has a built-in rate limiter with a memory store.</p>
<p><strong>Usage</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> svc = broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        rateLimit: &#123;</span><br><span class="line">            <span class="comment">// How long to keep record of requests in memory (in milliseconds).</span></span><br><span class="line">            <span class="comment">// Defaults to 60000 (1 min)</span></span><br><span class="line">            <span class="built_in">window</span>: <span class="number">60</span> * <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Max number of requests during window. Defaults to 30</span></span><br><span class="line">            limit: <span class="number">30</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Set rate limit headers to response. Defaults to false</span></span><br><span class="line">            headers: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Function used to generate keys. Defaults to:</span></span><br><span class="line">            key: <span class="function"><span class="params">req</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    req.headers[<span class="string">"x-forwarded-for"</span>] ||</span><br><span class="line">                    req.connection.remoteAddress ||</span><br><span class="line">                    req.socket.remoteAddress ||</span><br><span class="line">                    req.connection.socket.remoteAddress</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//StoreFactory: CustomStore</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Custom-Store-example" class="article-heading"><a href="#Custom-Store-example" class="headerlink" title="Custom Store example"></a>Custom Store example<a class="article-anchor" href="#Custom-Store-example" aria-hidden="true"></a></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomStore</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(window, opts) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hits = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line">        <span class="keyword">this</span>.resetTime = <span class="built_in">Date</span>.now() + clearPeriod;</span><br><span class="line"></span><br><span class="line">        setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.resetTime = <span class="built_in">Date</span>.now() + clearPeriod;</span><br><span class="line">            <span class="keyword">this</span>.reset();</span><br><span class="line">        &#125;, clearPeriod);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Increment the counter by key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param &#123;String&#125; key</span></span><br><span class="line"><span class="comment">     * @returns &#123;Number&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    inc(key) &#123;</span><br><span class="line">        <span class="keyword">let</span> counter = <span class="keyword">this</span>.hits.get(key) || <span class="number">0</span>;</span><br><span class="line">        counter++;</span><br><span class="line">        <span class="keyword">this</span>.hits.set(key, counter);</span><br><span class="line">        <span class="keyword">return</span> counter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Reset all counters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    reset() &#123;</span><br><span class="line">        <span class="keyword">this</span>.hits.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ExpressJS-middleware-usage" class="article-heading"><a href="#ExpressJS-middleware-usage" class="headerlink" title="ExpressJS middleware usage"></a>ExpressJS middleware usage<a class="article-anchor" href="#ExpressJS-middleware-usage" aria-hidden="true"></a></h2><p>You can use Moleculer-Web as a middleware in an <a href="http://expressjs.com/" target="_blank" rel="noopener">ExpressJS</a> application.</p>
<p><strong>Usage</strong></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> svc = broker.createService(&#123;</span><br><span class="line">    mixins: [ApiService],</span><br><span class="line"></span><br><span class="line">    settings: &#123;</span><br><span class="line">        middleware: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create Express application</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Use ApiGateway as middleware</span></span><br><span class="line">app.use(<span class="string">"/api"</span>, svc.express());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Listening</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start server</span></span><br><span class="line">broker.start();</span><br></pre></td></tr></table></figure>
<h2 id="Full-service-settings" class="article-heading"><a href="#Full-service-settings" class="headerlink" title="Full service settings"></a>Full service settings<a class="article-anchor" href="#Full-service-settings" aria-hidden="true"></a></h2><p>List of all settings of Moleculer Web service:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">settings: &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Exposed port</span></span><br><span class="line">    port: <span class="number">3000</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Exposed IP</span></span><br><span class="line">    ip: <span class="string">"0.0.0.0"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// HTTPS server with certificate</span></span><br><span class="line">    https: &#123;</span><br><span class="line">        key: fs.readFileSync(<span class="string">"ssl/key.pem"</span>),</span><br><span class="line">        cert: fs.readFileSync(<span class="string">"ssl/cert.pem"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Middleware mode (for ExpressJS)</span></span><br><span class="line">    middleware: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Exposed global path prefix</span></span><br><span class="line">    path: <span class="string">"/api"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Global-level middlewares</span></span><br><span class="line">    use: [</span><br><span class="line">        compression(),</span><br><span class="line">        cookieParser()</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Logging request parameters with 'info' level</span></span><br><span class="line">    logRequestParams: <span class="string">"info"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Logging response data with 'debug' level</span></span><br><span class="line">    logResponseData: <span class="string">"debug"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Routes</span></span><br><span class="line">    routes: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Path prefix to this route  (full path: /api/admin )</span></span><br><span class="line">            path: <span class="string">"/admin"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Whitelist of actions (array of string mask or regex)</span></span><br><span class="line">            whitelist: [</span><br><span class="line">                <span class="string">"users.get"</span>,</span><br><span class="line">                <span class="string">"$node.*"</span></span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Call the `this.authorize` method before call the action</span></span><br><span class="line">            authorization: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Merge parameters from querystring, request params &amp; body</span></span><br><span class="line">            mergeParams: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Route-level middlewares</span></span><br><span class="line">            uses: [</span><br><span class="line">                helmet(),</span><br><span class="line">                passport.initialize()</span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Action aliases</span></span><br><span class="line">            aliases: &#123;</span><br><span class="line">                <span class="string">"POST users"</span>: <span class="string">"users.create"</span>,</span><br><span class="line">                <span class="string">"health"</span>: <span class="string">"$node.health"</span></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            mappingPolicy: <span class="string">"all"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Use bodyparser module</span></span><br><span class="line">            bodyParsers: &#123;</span><br><span class="line">                json: <span class="literal">true</span>,</span><br><span class="line">                urlencoded: &#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Path prefix to this route  (full path: /api )</span></span><br><span class="line">            path: <span class="string">""</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Whitelist of actions (array of string mask or regex)</span></span><br><span class="line">            whitelist: [</span><br><span class="line">                <span class="string">"posts.*"</span>,</span><br><span class="line">                <span class="string">"file.*"</span>,</span><br><span class="line">                /^math\.\w+$/</span><br><span class="line">            ],</span><br><span class="line"></span><br><span class="line">            <span class="comment">// No authorization</span></span><br><span class="line">            authorization: <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Action aliases</span></span><br><span class="line">            aliases: &#123;</span><br><span class="line">                <span class="string">"add"</span>: <span class="string">"math.add"</span>,</span><br><span class="line">                <span class="string">"GET sub"</span>: <span class="string">"math.sub"</span>,</span><br><span class="line">                <span class="string">"POST divide"</span>: <span class="string">"math.div"</span>,</span><br><span class="line">                <span class="string">"GET greeter/:name"</span>: <span class="string">"test.greeter"</span>,</span><br><span class="line">                <span class="string">"GET /"</span>: <span class="string">"test.hello"</span>,</span><br><span class="line">                <span class="string">"POST upload"</span>(req, res) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.parseUploadedFile(req, res);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            mappingPolicy: <span class="string">"restrict"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Use bodyparser module</span></span><br><span class="line">            bodyParsers: &#123;</span><br><span class="line">                json: <span class="literal">false</span>,</span><br><span class="line">                urlencoded: &#123; <span class="attr">extended</span>: <span class="literal">true</span> &#125;</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Calling options</span></span><br><span class="line">            callOptions: &#123;</span><br><span class="line">                timeout: <span class="number">3000</span>,</span><br><span class="line">                retries: <span class="number">3</span>,</span><br><span class="line">                fallbackResponse: <span class="string">"Static fallback response"</span></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Call before `broker.call`</span></span><br><span class="line">            onBeforeCall(ctx, route, req, res) &#123;</span><br><span class="line">                ctx.meta.userAgent = req.headers[<span class="string">"user-agent"</span>];</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Call after `broker.call` and before send back the response</span></span><br><span class="line">            onAfterCall(ctx, route, req, res, data) &#123;</span><br><span class="line">                res.setHeader(<span class="string">"X-Custom-Header"</span>, <span class="string">"123456"</span>);</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Route error handler</span></span><br><span class="line">            onError(req, res, err) &#123;</span><br><span class="line">                res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">                res.writeHead(err.code || <span class="number">500</span>);</span><br><span class="line">                res.end(<span class="string">"Route error: "</span> + err.message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Folder to server assets (static files)</span></span><br><span class="line">    assets: &#123;</span><br><span class="line">        <span class="comment">// Root folder of assets</span></span><br><span class="line">        folder: <span class="string">"./examples/www/assets"</span>,</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Options to `server-static` module</span></span><br><span class="line">        options: &#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Global error handler</span></span><br><span class="line">    onError(req, res, err) &#123;</span><br><span class="line">        res.setHeader(<span class="string">"Content-Type"</span>, <span class="string">"text/plain"</span>);</span><br><span class="line">        res.writeHead(err.code || <span class="number">500</span>);</span><br><span class="line">        res.end(<span class="string">"Global error: "</span> + err.message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Examples" class="article-heading"><a href="#Examples" class="headerlink" title="Examples"></a>Examples<a class="article-anchor" href="#Examples" aria-hidden="true"></a></h2><ul>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/simple/index.js" target="_blank" rel="noopener">Simple</a></p>
<ul>
<li>simple gateway with default settings.</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/ssl/index.js" target="_blank" rel="noopener">SSL server</a></p>
<ul>
<li>open HTTPS server</li>
<li>whitelist handling</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/www/index.js" target="_blank" rel="noopener">WWW with assets</a></p>
<ul>
<li>serve static files from the <code>assets</code> folder</li>
<li>whitelist</li>
<li>aliases</li>
<li>multiple body-parsers</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/authorization/index.js" target="_blank" rel="noopener">Authorization</a></p>
<ul>
<li>simple authorization demo</li>
<li>set the authorized user to <code>Context.meta</code></li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/rest/index.js" target="_blank" rel="noopener">REST</a></p>
<ul>
<li>simple server with RESTful aliases</li>
<li>example <code>posts</code> service with CRUD actions</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/express/index.js" target="_blank" rel="noopener">Express</a></p>
<ul>
<li>webserver with Express</li>
<li>use moleculer-web as a middleware</li>
</ul>
</li>
<li><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/socket.io/index.js" target="_blank" rel="noopener">Socket.io</a><ul>
<li>start socket.io websocket server</li>
<li>call action and send back the response via websocket</li>
<li>send Moleculer events to the browser via websocket</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/full/index.js" target="_blank" rel="noopener">Full</a></p>
<ul>
<li>SSL</li>
<li>static files</li>
<li>middlewares</li>
<li>multiple routes with different roles</li>
<li>role-based authorization with JWT</li>
<li>whitelist</li>
<li>aliases with named params</li>
<li>multiple body-parsers</li>
<li>before &amp; after hooks</li>
<li>metrics, statistics &amp; validation from Moleculer</li>
<li>custom error handlers</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/webpack" target="_blank" rel="noopener">Webpack</a></p>
<ul>
<li>Webpack development environment for client-side developing</li>
<li>webpack config file</li>
<li>compression</li>
<li>static file serving</li>
</ul>
</li>
<li><p><a href="https://github.com/moleculer-go/moleculer-web/blob/master/examples/webpack-vue" target="_blank" rel="noopener">Webpack-Vue</a></p>
<ul>
<li>Webpack+Vue development environment for VueJS client developing</li>
<li>webpack config file</li>
<li>Hot-replacement</li>
<li>Babel, SASS, SCSS, Vue SFC</li>
</ul>
</li>
</ul>

              </div>
              <footer class="article-footer">
                <time class="article-footer-updated" datetime="2019-04-20T06:16:01.835Z" itemprop="dateModified">Last updated: 2019-04-20</time>
                <a href="runner.html" class="article-footer-prev" title="Moleculer Runner"><i class="fa fa-chevron-left"></i><span>Prev</span></a><a href="moleculer-repl.html" class="article-footer-next" title="REPL console"><span>Next</span><i class="fa fa-chevron-right"></i></a>
              </footer>
              
            </div>
          </div>
          <aside id="article-toc" role="navigation">
            <div id="article-toc-inner">
              <strong class="sidebar-title">Contents</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#API-Gateway"><span class="toc-text">API Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#moleculer-web"><span class="toc-text">moleculer-web </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Features"><span class="toc-text">Features</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Install"><span class="toc-text">Install</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Usage"><span class="toc-text">Usage</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Run-with-default-settings"><span class="toc-text">Run with default settings</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Whitelist"><span class="toc-text">Whitelist</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Aliases"><span class="toc-text">Aliases</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Mapping-policy"><span class="toc-text">Mapping policy</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Parameters"><span class="toc-text">Parameters</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Disable-merging"><span class="toc-text">Disable merging</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Query-string-parameters"><span class="toc-text">Query string parameters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Middlewares"><span class="toc-text">Middlewares</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Error-handler-middleware"><span class="toc-text">Error-handler middleware</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Serve-static-files"><span class="toc-text">Serve static files</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Calling-options"><span class="toc-text">Calling options</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multiple-routes"><span class="toc-text">Multiple routes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Response-type-amp-status-code"><span class="toc-text">Response type &amp; status code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authorization"><span class="toc-text">Authorization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Authentication"><span class="toc-text">Authentication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Route-hooks"><span class="toc-text">Route hooks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Error-handlers"><span class="toc-text">Error handlers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CORS-headers"><span class="toc-text">CORS headers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rate-limiter"><span class="toc-text">Rate limiter</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Custom-Store-example"><span class="toc-text">Custom Store example</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ExpressJS-middleware-usage"><span class="toc-text">ExpressJS middleware usage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Full-service-settings"><span class="toc-text">Full service settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Examples"><span class="toc-text">Examples</span></a></li></ol></li></ol>
              <a href="#" id="article-toc-top">Back to Top</a>
            </div>
          </aside>
        </div>
      </article>
      <aside id="sidebar" role="navigation">
  <div class="inner"><div class="version-selector"><select onchange="changeVersion(this)"><option value="docs/0.1" selected>v0.1</option></select></div><strong class="sidebar-title">Introduction</strong><a href="/docs/0.1/index.html" class="sidebar-link">What is Moleculer?</a><a href="/docs/0.1/usage.html" class="sidebar-link">Usage</a><a href="/docs/0.1/examples.html" class="sidebar-link">Examples</a><strong class="sidebar-title">Overview</strong><a href="/docs/0.1/broker.html" class="sidebar-link">Broker</a><a href="/docs/0.1/services.html" class="sidebar-link">Services</a><a href="/docs/0.1/actions.html" class="sidebar-link">Actions</a><a href="/docs/0.1/events.html" class="sidebar-link">Events</a><a href="/docs/0.1/lifecycle.html" class="sidebar-link">Lifecycles</a><a href="/docs/0.1/logging.html" class="sidebar-link">Logging</a><a href="/docs/0.1/middlewares.html" class="sidebar-link">Middlewares</a><a href="/docs/0.1/networking.html" class="sidebar-link">Networking</a><a href="/docs/0.1/registry.html" class="sidebar-link">Discovery & Registry</a><a href="/docs/0.1/balancing.html" class="sidebar-link">Load balancing</a><a href="/docs/0.1/fault-tolerance.html" class="sidebar-link">Fault tolerance</a><a href="/docs/0.1/caching.html" class="sidebar-link">Caching</a><a href="/docs/0.1/validating.html" class="sidebar-link">Validating</a><a href="/docs/0.1/metrics.html" class="sidebar-link">Metrics & Tracing</a><a href="/docs/0.1/errors.html" class="sidebar-link">Errors</a><a href="/docs/0.1/runner.html" class="sidebar-link">Moleculer Runner</a><strong class="sidebar-title">Modules</strong><a href="/docs/0.1/moleculer-web.html" class="sidebar-link current">API Gateway</a><a href="/docs/0.1/moleculer-repl.html" class="sidebar-link">REPL console</a><a href="/docs/0.1/moleculer-cli.html" class="sidebar-link">CLI Tool</a><a href="/docs/0.1/moleculer-db.html" class="sidebar-link">DB Adapters</a><a href="/modules.html" class="sidebar-link">All modules</a><strong class="sidebar-title">Miscellaneous</strong><a href="/docs/0.1/clustering.html" class="sidebar-link">Clustering</a><a href="/docs/0.1/deploying.html" class="sidebar-link">Deploying</a><a href="/docs/0.1/benchmark.html" class="sidebar-link">Benchmark</a><a href="/docs/0.1/faq.html" class="sidebar-link">FAQ</a><a href="/docs/0.1/contributing.html" class="sidebar-link">Contributing</a><strong class="sidebar-title">API</strong><a href="/docs/0.1/api/service-broker.html" class="sidebar-link">ServiceBroker</a><a href="/docs/0.1/api/service.html" class="sidebar-link">Service</a><a href="/docs/0.1/api/context.html" class="sidebar-link">Context</a><a href="/docs/0.1/api/protocol.html" class="sidebar-link">Protocol</a></div>
</aside>
    </div>
  </div>
</div>

    <footer id="footer" class="wrapper">
  <div class="inner">
    <div id="footer-copyright">
      Copyright &copy; 2018-2019 <a href="https://github.com/pentateu" target="_blank">MoleculerGO</a><br>
      Documentation licensed under <a href="http://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0</a>.
    </div>
    <div id="footer-links">
      <a href="https://gitter.im/moleculer-go/moleculer" class="footer-link" target="_blank"><i class="fa fa-comments-o"></i></a>
      <a href="https://twitter.com/MoleculerG" class="footer-link" target="_blank"><i class="fa fa-twitter"></i></a>
      <a href="https://github.com/moleculer-go/moleculer" class="footer-link" target="_blank"><i class="fa fa-github-alt"></i></a>
      <a href="https://stackoverflow.com/questions/tagged/moleculer-go" class="footer-link" target="_blank"><i class="fa fa-stack-overflow"></i></a>
    </div>
  </div>
</footer>

  </div>
  <div id="mobile-nav-dimmer"></div>
  <nav id="mobile-nav">
  <div id="mobile-nav-inner">
    <ul id="mobile-nav-list">
      <a href="/docs/0.1/" class="mobile-nav-link">Documentation</a><a href="/modules.html" class="mobile-nav-link">Modules</a><a href="/support.html" class="mobile-nav-link">Support</a>
      <li class="mobile-nav-item">
        <a href="https://github.com/moleculer-go/moleculer" class="mobile-nav-link" rel="external" target="_blank">GitHub</a>
      </li>
    </ul>
    
      <div class="version-selector"><select onchange="changeVersion(this)"><option value="docs/0.1" selected>v0.1</option></select></div><strong class="mobile-nav-title">Introduction</strong><a href="/docs/0.1/index.html" class="mobile-nav-link">What is Moleculer?</a><a href="/docs/0.1/usage.html" class="mobile-nav-link">Usage</a><a href="/docs/0.1/examples.html" class="mobile-nav-link">Examples</a><strong class="mobile-nav-title">Overview</strong><a href="/docs/0.1/broker.html" class="mobile-nav-link">Broker</a><a href="/docs/0.1/services.html" class="mobile-nav-link">Services</a><a href="/docs/0.1/actions.html" class="mobile-nav-link">Actions</a><a href="/docs/0.1/events.html" class="mobile-nav-link">Events</a><a href="/docs/0.1/lifecycle.html" class="mobile-nav-link">Lifecycles</a><a href="/docs/0.1/logging.html" class="mobile-nav-link">Logging</a><a href="/docs/0.1/middlewares.html" class="mobile-nav-link">Middlewares</a><a href="/docs/0.1/networking.html" class="mobile-nav-link">Networking</a><a href="/docs/0.1/registry.html" class="mobile-nav-link">Discovery & Registry</a><a href="/docs/0.1/balancing.html" class="mobile-nav-link">Load balancing</a><a href="/docs/0.1/fault-tolerance.html" class="mobile-nav-link">Fault tolerance</a><a href="/docs/0.1/caching.html" class="mobile-nav-link">Caching</a><a href="/docs/0.1/validating.html" class="mobile-nav-link">Validating</a><a href="/docs/0.1/metrics.html" class="mobile-nav-link">Metrics & Tracing</a><a href="/docs/0.1/errors.html" class="mobile-nav-link">Errors</a><a href="/docs/0.1/runner.html" class="mobile-nav-link">Moleculer Runner</a><strong class="mobile-nav-title">Modules</strong><a href="/docs/0.1/moleculer-web.html" class="mobile-nav-link current">API Gateway</a><a href="/docs/0.1/moleculer-repl.html" class="mobile-nav-link">REPL console</a><a href="/docs/0.1/moleculer-cli.html" class="mobile-nav-link">CLI Tool</a><a href="/docs/0.1/moleculer-db.html" class="mobile-nav-link">DB Adapters</a><a href="/modules.html" class="mobile-nav-link">All modules</a><strong class="mobile-nav-title">Miscellaneous</strong><a href="/docs/0.1/clustering.html" class="mobile-nav-link">Clustering</a><a href="/docs/0.1/deploying.html" class="mobile-nav-link">Deploying</a><a href="/docs/0.1/benchmark.html" class="mobile-nav-link">Benchmark</a><a href="/docs/0.1/faq.html" class="mobile-nav-link">FAQ</a><a href="/docs/0.1/contributing.html" class="mobile-nav-link">Contributing</a><strong class="mobile-nav-title">API</strong><a href="/docs/0.1/api/service-broker.html" class="mobile-nav-link">ServiceBroker</a><a href="/docs/0.1/api/service.html" class="mobile-nav-link">Service</a><a href="/docs/0.1/api/context.html" class="mobile-nav-link">Context</a><a href="/docs/0.1/api/protocol.html" class="mobile-nav-link">Protocol</a>
    
  </div>
  <div id="mobile-lang-select-wrap">
    <span id="mobile-lang-select-label"><i class="fa fa-globe"></i><span>English</span></span>
    <select id="mobile-lang-select" data-canonical="">
      
        <option value="en" selected>English</option>
      
    </select>
  </div>
</nav>
  <!-- Scripts -->
<!-- build:js build/js/main.js -->
<script src="/js/lang_select.js"></script>
<script src="/js/version_select.js"></script>
<script src="/js/scrollingelement.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/mobile_nav.js"></script>
<!-- endbuild -->
<script src="https://cdn.jsdelivr.net/retinajs/1.3.0/retina.min.js" async></script>

<!-- Algolia -->

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: '7d5514b7c3e161a428f04f33ba1bdab4',
indexName: 'moleculer',
inputSelector: '#search-input',
algoliaOptions: { 'facetFilters': ["version:0.1"] },
debug: false // Set debug to true if you want to inspect the dropdown
});
</script>


<!-- fastclick -->
<script src="//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  FastClick.attach(document.body)
}, false)
</script>

<!-- Gitter Chat -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'moleculer-go/moleculer'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
</body>
</html>